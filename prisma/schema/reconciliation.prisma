model MscBatch {
  id                   String                 @id @default(cuid())
  externalId           String?                @unique
  batchDate            DateTime
  totalAmount          Decimal                @db.Decimal(12, 2)
  reconciliationStatus ReconciliationStatus   @default(PENDING)
  reconciledAt         DateTime?

  qboDeposit           QboDeposit?
  blueprintTransactions BlueprintTransaction[]
  syncLogs             SyncLog[]

  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt

  @@index([batchDate])
  @@index([reconciliationStatus])
  @@map("msc_batches")
}

model QboDeposit {
  id            String    @id @default(cuid())
  externalId    String?   @unique
  depositDate   DateTime
  totalAmount   Decimal   @db.Decimal(12, 2)

  batchId       String?   @unique
  batch         MscBatch? @relation(fields: [batchId], references: [id], onDelete: SetNull, onUpdate: Restrict)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([depositDate])
  @@map("qbo_deposits")
}

model BlueprintTransaction {
  id            String   @id @default(cuid())
  externalId    String?  @unique
  transactionDate DateTime
  amount        Decimal  @db.Decimal(12, 2)
  description   String?  @db.VarChar(255)

  batchId       String?
  batch         MscBatch? @relation(fields: [batchId], references: [id], onDelete: SetNull, onUpdate: Restrict)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([transactionDate])
  @@index([batchId])
  @@map("blueprint_transactions")
}

model SyncLog {
  id           String      @id @default(cuid())
  provider     SyncProvider
  operation    String
  status       SyncStatus  @default(PENDING)
  httpStatus   Int?
  startedAt    DateTime    @default(now())
  finishedAt   DateTime?
  errorMessage String?     @db.Text
  request      Json?
  response     Json?

  batchId      String?
  batch        MscBatch?   @relation(fields: [batchId], references: [id], onDelete: SetNull, onUpdate: Restrict)

  @@index([provider, startedAt])
  @@index([status])
  @@map("sync_logs")
}

model QboToken {
  id           String   @id @default(cuid())
  accessToken  String   @db.Text
  refreshToken String   @db.Text
  realmId      String   @unique @db.VarChar(64)
  expiresAt    DateTime

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([expiresAt])
  @@map("qbo_tokens")
}
